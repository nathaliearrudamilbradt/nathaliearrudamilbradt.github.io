<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Pesquisa de Opinião</title>
<style>
	body { font-family: 'Arial', sans-serif; margin: 20px; background: #f4f4f4; color: #333; }
	h1 { text-align: center; color: #444; }
	#timer { font-size: 18px; color: #000; text-align: center; margin-bottom: 10px; }
	#chatbox {
		border: 2px solid #ddd; border-radius: 10px; padding: 15px; background: #fff;
		height: 400px; overflow-y: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
		margin-bottom: 10px; font-size: 16px; white-space: pre-wrap; word-wrap: break-word;
	}
	#user-input {
		width: calc(100% - 80px); padding: 10px; font-size: 16px; border: 2px solid #ddd;
		border-radius: 20px; outline: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
	}
	.message { margin: 10px 0; padding: 10px; border-radius: 10px; max-width: 80%; line-height: 1.5; }
	.user { background: #cce5ff; align-self: flex-end; color: #004085; text-align: right; margin-left: auto; }
	.assistant { background: #f8d7da; align-self: flex-start; color: #721c24; text-align: left; margin-right: auto; }
	#description p {
		font-size: 18px; color: #333; background-color: #f9f9f9; padding: 15px;
		border: 1px solid #ddd; border-radius: 10px; margin: 0 auto; max-width: 700px;
	}
	.survey-container {
		display: flex; justify-content: center; align-items: center;
		background-color: #f9f9f9; margin: 0 auto; max-width: 800px; padding: 20px; display: none;
	}
    
    /* Estilos da Escala Responsiva */
    .scale-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; }
    .scale-options { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    
    /* Estilo para Tabela Likert (IA) */
    .likert-table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .likert-table th, .likert-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .likert-table th { background-color: #eee; }
    .likert-row-label { text-align: left !important; width: 40%; }

    /* Estilo para as caixas de Consulta Pública (Final) */
    .consultation-box {
        display: block;
        background-color: #fff;
        border: 2px solid #004085;
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
        text-decoration: none;
        color: #333;
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
    }
    .consultation-box:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        background-color: #f0f8ff;
    }
    .consultation-title {
        font-weight: bold;
        color: #0056b3;
        font-size: 16px;
        margin-bottom: 5px;
        display: block;
    }
    .consultation-url {
        font-size: 12px;
        color: #666;
        display: block;
    }

    @media (max-width: 600px) {
        .scale-options { flex-wrap: nowrap; overflow-x: auto; justify-content: flex-start; width: 100%; padding-bottom: 10px; }
        .scale-options label { flex: 0 0 auto; min-width: 30px; }
        #ai-scale { flex-direction: column; gap: 10px !important; align-items: center; width: 100%; }
        #ai-scale label { width: 80%; display: flex; flex-direction: row; justify-content: center; padding: 8px 0; border: 1px solid #ddd; border-radius: 5px; }
        #ai-scale label input[type="radio"] { margin-right: 5px; }
        
        /* Ajuste tabela mobile */
        .likert-table { font-size: 12px; }
        .likert-table th, .likert-table td { padding: 4px; }
    }
</style>
</head>
<body>

<div id="consent-section" style="margin-top: 50px;">
	<p style="font-size: 18px; color: #555; line-height: 1.5; margin-bottom: 20px;">
		<strong>Termo de consentimento </strong><br><br>
		Você está sendo convidado(a) a participar de um estudo de pesquisa acadêmica. Sua participação é totalmente voluntária.
		<br><br>
		<b>Propósito da Pesquisa.</b><br>
		Este estudo faz parte de uma pesquisa acadêmica cujo objetivo é entender melhor como modelos de inteligência artificial podem influenciar opiniões e raciocínio político. Você está sendo convidado(a) porque tem mais de 18 anos e é brasileiro(a).
		<br><br>
		<b>Procedimentos.</b><br>
		Durante o estudo, você verá uma série de cenários políticos hipotéticos e responderá perguntas sobre eles. Em alguns casos, poderá ser convidado(a) a interagir por alguns minutos com uma ferramenta automatizada com inteligência artificial antes de responder às perguntas. Ao final, você será solicitado(a) a registrar sua opinião.
		<br><br>
		<b>Duração.</b><br>
		A participação envolverá aproximadamente 10 minutos do seu tempo.
		<br><br>
		<b>Riscos e Benefícios.</b><br>
		Não esperamos riscos associados à sua participação. Você não receberá benefícios diretos, mas contribuirá para a ciência.
		<br><br>
		<b>Privacidade.</b><br>
		Todas as suas respostas serão mantidas 100% confidenciais e anônimas.
		<br><br>
		Em caso de dúvidas: <i>Nathalie Arruda Milbradt (nathaliearrudamilbradt@college.harvard.edu)</i>
	</p>
	<button onclick="acceptConsent()" style="margin-right: 10px; padding: 10px 20px; font-size: 18px; cursor: pointer;">Aceito os termos</button>
    <button onclick="declineConsent()" style="padding: 10px 20px; font-size: 18px; cursor: pointer;">Recuso os termos</button>
</div>

<div id="instructions" style="margin-top: 50px; display: none;">
	<p style="font-size: 18px; color: #555; line-height: 1.5; margin-bottom: 20px;">
		Em seguida, vamos apresentar algumas <strong>propostas políticas</strong>.
		<br><br>
		Para ajudar na decisão, em alguns casos você poderá conversar com um <strong>assistente de inteligência artificial (IA)</strong>.
		<br><br>
		Quando o chatbot estiver disponível, pedimos que você converse com ele por <strong>pelo menos 3 minutos</strong>.
	</p>
	<button onclick="startExperiment()" style="margin-right: 10px; padding: 10px 20px; font-size: 18px; cursor: pointer;">Iniciar</button>
</div>

<div class="survey-container">
	<div id="survey-questions" style="display: none; text-align: left; margin-top: 20px; width: 100%;">
        
        <div class="survey-page" id="page-1" style="display: block;">
			<p>Qual das opções descreve melhor você?</p>
			<div style="text-align: left;">
				<input id="q1_opt1" name="question1" type="radio" value="br_18plus"/><label for="q1_opt1">Sou brasileira(o) e tenho 18 anos ou mais</label><br/>
				<input id="q1_opt2" name="question1" type="radio" value="br_under18"/><label for="q1_opt2">Sou brasileira(o) e tenho menos de 18 anos</label><br/>
				<input id="q1_opt3" name="question1" type="radio" value="not_brazilian"/><label for="q1_opt3">Não sou brasileira(o)</label><br/>
			</div>
		</div>

        <div class="survey-page" id="page-2" style="display: none;">
			<p>Qual é o seu gênero?</p>
			<div style="text-align: left;">
				<input name="demo_genero" type="radio" value="feminino"/> Feminino<br/>
				<input name="demo_genero" type="radio" value="masculino"/> Masculino<br/>
				<input name="demo_genero" type="radio" value="outro"/> Outro<br/>
				<input name="demo_genero" type="radio" value="prefiro_nao_responder"/> Prefiro não responder<br/>
			</div>
		</div>

        <div class="survey-page" id="page-3" style="display: none;">
			<p>Em qual região do Brasil você mora atualmente?</p>
			<div style="text-align: left;">
				<input name="demo_regiao" type="radio" value="norte"/> Norte<br/>
				<input name="demo_regiao" type="radio" value="nordeste"/> Nordeste<br/>
				<input name="demo_regiao" type="radio" value="centro_oeste"/> Centro-Oeste<br/>
				<input name="demo_regiao" type="radio" value="sudeste"/> Sudeste<br/>
				<input name="demo_regiao" type="radio" value="sul"/> Sul<br/>
			</div>
		</div>

        <div class="survey-page" id="page-4" style="display: none;">
			<p>Qual é a sua faixa etária?</p>
			<div style="text-align: left;">
				<input name="demo_faixa_etaria" type="radio" value="18_24"/> 18 a 24 anos<br/>
				<input name="demo_faixa_etaria" type="radio" value="25_34"/> 25 a 34 anos<br/>
				<input name="demo_faixa_etaria" type="radio" value="35_44"/> 35 a 44 anos<br/>
				<input name="demo_faixa_etaria" type="radio" value="45_54"/> 45 a 54 anos<br/>
				<input name="demo_faixa_etaria" type="radio" value="55_mais"/> 55 anos ou mais<br/>
			</div>
		</div>

        <div class="survey-page" id="page-5" style="display: none;">
			<p>Como você se autodeclara em termos de cor ou raça?</p>
			<div>
				<input name="demo_cor" type="radio" value="branca"/> Branca<br/>
				<input name="demo_cor" type="radio" value="preta"/> Preta<br/>
				<input name="demo_cor" type="radio" value="parda"/> Parda<br/>
				<input name="demo_cor" type="radio" value="amarela"/> Amarela<br/>
				<input name="demo_cor" type="radio" value="indigena"/> Indígena<br/>
				<input name="demo_cor" type="radio" value="outra"/> Outra<br/>
			</div>
            <br>
            <p>Qual é a renda mensal total do seu domicílio?</p>
			<div>
				<input name="demo_renda" type="radio" value="ate_1sm"/> Até 1 salário mínimo<br/>
				<input name="demo_renda" type="radio" value="1a2sm"/> Entre 1 e 2 salários mínimos<br/>
				<input name="demo_renda" type="radio" value="2a5sm"/> Entre 2 e 5 salários mínimos<br/>
				<input name="demo_renda" type="radio" value="5a10sm"/> Entre 5 e 10 salários mínimos<br/>
				<input name="demo_renda" type="radio" value="mais_10sm"/> Mais de 10 salários mínimos<br/>
			</div>
		</div>

        <div class="survey-page" id="page-6" style="display: none;">
			<p>Qual é a sua religião?</p>
			<div>
				<input name="demo_religiao" type="radio" value="catolica"/> Católica<br/>
				<input name="demo_religiao" type="radio" value="evangelica_pentecostal"/> Evangélica – Pentecostal<br/>
				<input name="demo_religiao" type="radio" value="evangelica_nao_pentecostal"/> Evangélica – Não pentecostal<br/>
				<input name="demo_religiao" type="radio" value="espirita"/> Espírita<br/>
				<input name="demo_religiao" type="radio" value="umbanda_candomble"/> Umbanda / Candomblé<br/>
				<input name="demo_religiao" type="radio" value="outra"/> Outra religião<br/>
				<input name="demo_religiao" type="radio" value="sem_religiao"/> Sem religião<br/>
			</div>
            <br>
            <p>Qual o nível mais alto de escolaridade que você completou?</p>
			<div>
				<input name="demo_escolaridade" type="radio" value="fundamental_incompleto"/> Ensino fundamental incompleto<br/>
				<input name="demo_escolaridade" type="radio" value="fundamental_completo"/> Ensino fundamental completo<br/>
				<input name="demo_escolaridade" type="radio" value="medio_incompleto"/> Ensino médio incompleto<br/>
				<input name="demo_escolaridade" type="radio" value="medio_completo"/> Ensino médio completo<br/>
				<input name="demo_escolaridade" type="radio" value="superior_incompleto"/> Ensino superior incompleto<br/>
				<input name="demo_escolaridade" type="radio" value="superior_completo"/> Ensino superior completo<br/>
				<input name="demo_escolaridade" type="radio" value="pos_graduacao"/> Pós-graduação<br/>
			</div>
		</div>

        <div class="survey-page" id="page-7" style="display: none;">
            <p>Para cada uma das afirmações abaixo, indique o quanto você concorda ou discorda:</p>
            <table class="likert-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>Discordo totalmente</th>
                        <th>Discordo</th>
                        <th>Neutro</th>
                        <th>Concordo</th>
                        <th>Concordo totalmente</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="likert-row-label">Para transações rotineiras, eu preferiria interagir com um sistema de inteligência artificial em vez de um ser humano.</td>
                        <td><input type="radio" name="q_ai_preference" value="1"></td>
                        <td><input type="radio" name="q_ai_preference" value="2"></td>
                        <td><input type="radio" name="q_ai_preference" value="3"></td>
                        <td><input type="radio" name="q_ai_preference" value="4"></td>
                        <td><input type="radio" name="q_ai_preference" value="5"></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">Um agente de inteligência artificial seria melhor do que um funcionário em muitos trabalhos rotineiros.</td>
                        <td><input type="radio" name="q_ai_better_worker" value="1"></td>
                        <td><input type="radio" name="q_ai_better_worker" value="2"></td>
                        <td><input type="radio" name="q_ai_better_worker" value="3"></td>
                        <td><input type="radio" name="q_ai_better_worker" value="4"></td>
                        <td><input type="radio" name="q_ai_better_worker" value="5"></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">Eu sinto desconforto quando penso nos usos futuros da inteligência artificial.</td>
                        <td><input type="radio" name="q_ai_discomfort" value="1"></td>
                        <td><input type="radio" name="q_ai_discomfort" value="2"></td>
                        <td><input type="radio" name="q_ai_discomfort" value="3"></td>
                        <td><input type="radio" name="q_ai_discomfort" value="4"></td>
                        <td><input type="radio" name="q_ai_discomfort" value="5"></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">A inteligência artificial pode vir a assumir o controle das pessoas.</td>
                        <td><input type="radio" name="q_ai_control" value="1"></td>
                        <td><input type="radio" name="q_ai_control" value="2"></td>
                        <td><input type="radio" name="q_ai_control" value="3"></td>
                        <td><input type="radio" name="q_ai_control" value="4"></td>
                        <td><input type="radio" name="q_ai_control" value="5"></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">Sistemas de inteligência artificial deveriam ser usados apenas para assuntos sem importância.</td>
                        <td><input type="radio" name="q_ai_trivial" value="1"></td>
                        <td><input type="radio" name="q_ai_trivial" value="2"></td>
                        <td><input type="radio" name="q_ai_trivial" value="3"></td>
                        <td><input type="radio" name="q_ai_trivial" value="4"></td>
                        <td><input type="radio" name="q_ai_trivial" value="5"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="survey-page" id="page-8" style="display:none;">
			<h2>Informações Importantes</h2>
			<p>
				As próximas perguntas têm como objetivo compreender padrões de comportamento político.
				Suas respostas são totalmente anônimas.
			</p>
		</div>

        <div class="survey-page" id="page-9" style="display: none;">
			<p>Na eleição de 2022 para presidente, você:</p>
			<div>
				<input name="question2" type="radio" value="votou_1e2"/> Votou no 1º e no 2º turno<br/>
				<input name="question2" type="radio" value="votou_1"/> Votou somente no 1º turno<br/>
				<input name="question2" type="radio" value="votou_2"/> Votou somente no 2º turno<br/>
				<input name="question2" type="radio" value="nao_votou"/> Não votou em nenhum turno<br/>
				<input name="question2" type="radio" value="nao_podia_votar"/> Não podia votar na época<br/>
			</div>
            <div id="q3-container" style="margin-top:20px; display:none;">
                <p>Em quem você votou para presidente no segundo turno da eleição de 2022?</p>
                <div>
                    <input name="question3" type="radio" value="lula"/> Lula (PT)<br/>
                    <input name="question3" type="radio" value="bolsonaro"/> Bolsonaro (PL)<br/>
                    <input name="question3" type="radio" value="branco_nulo"/> Branco / nulo<br/>
                </div>
            </div>
		</div>

        <div class="survey-page" id="page-10" style="display: none;">
			<p>Escala 1 (Esquerda) a 10 (Direita). Onde você se encaixa?</p>
			<div class="scale-options">
                <label><input type="radio" name="question4" value="1">1</label>
                <label><input type="radio" name="question4" value="2">2</label>
                <label><input type="radio" name="question4" value="3">3</label>
                <label><input type="radio" name="question4" value="4">4</label>
                <label><input type="radio" name="question4" value="5">5</label>
                <label><input type="radio" name="question4" value="6">6</label>
                <label><input type="radio" name="question4" value="7">7</label>
                <label><input type="radio" name="question4" value="8">8</label>
                <label><input type="radio" name="question4" value="9">9</label>
                <label><input type="radio" name="question4" value="10">10</label>
            </div>
            <br>
            <p>Frequência de uso de fontes de informação:</p>
            <table style="width:100%; font-size:14px;">
                <tr><th>Fonte</th><th>Dia</th><th>Sem</th><th>Mês</th><th>Raro</th><th>Nunca</th></tr>
                <tr><td>Jornal diário</td><td><input type="radio" name="q5_jornal_diario" value="dia"></td><td><input type="radio" name="q5_jornal_diario" value="sem"></td><td><input type="radio" name="q5_jornal_diario" value="mes"></td><td><input type="radio" name="q5_jornal_diario" value="raro"></td><td><input type="radio" name="q5_jornal_diario" value="nunca"></td></tr>
                <tr><td>TV</td><td><input type="radio" name="q5_jornais_tv" value="dia"></td><td><input type="radio" name="q5_jornais_tv" value="sem"></td><td><input type="radio" name="q5_jornais_tv" value="mes"></td><td><input type="radio" name="q5_jornais_tv" value="raro"></td><td><input type="radio" name="q5_jornais_tv" value="nunca"></td></tr>
                <tr><td>Rádio</td><td><input type="radio" name="q5_jornais_radio" value="dia"></td><td><input type="radio" name="q5_jornais_radio" value="sem"></td><td><input type="radio" name="q5_jornais_radio" value="mes"></td><td><input type="radio" name="q5_jornais_radio" value="raro"></td><td><input type="radio" name="q5_jornais_radio" value="nunca"></td></tr>
                <tr><td>Redes sociais</td><td><input type="radio" name="q5_redes_sociais" value="dia"></td><td><input type="radio" name="q5_redes_sociais" value="sem"></td><td><input type="radio" name="q5_redes_sociais" value="mes"></td><td><input type="radio" name="q5_redes_sociais" value="raro"></td><td><input type="radio" name="q5_redes_sociais" value="nunca"></td></tr>
                <tr><td>Conversas</td><td><input type="radio" name="q5_conversas" value="dia"></td><td><input type="radio" name="q5_conversas" value="sem"></td><td><input type="radio" name="q5_conversas" value="mes"></td><td><input type="radio" name="q5_conversas" value="raro"></td><td><input type="radio" name="q5_conversas" value="nunca"></td></tr>
                <tr><td>IA (ChatGPT)</td><td><input type="radio" name="q5_ia" value="dia"></td><td><input type="radio" name="q5_ia" value="sem"></td><td><input type="radio" name="q5_ia" value="mes"></td><td><input type="radio" name="q5_ia" value="raro"></td><td><input type="radio" name="q5_ia" value="nunca"></td></tr>
            </table>
		</div>

        <div class="survey-page" id="page-11" style="display: none;">
			<p>Quem julga se uma lei é constitucional?</p>
			<div>
				<input name="question6" type="radio" value="camara"/> Câmara<br/>
				<input name="question6" type="radio" value="senado"/> Senado<br/>
				<input name="question6" type="radio" value="stf"/> STF<br/>
				<input name="question6" type="radio" value="presidencia"/> Presidência<br/>
                <input name="question6" type="radio" value="nao_sei"/> Não sei<br/>
			</div>
            <br>
            <p>Frequência eleições gerais?</p>
            <div>
				<input name="question7" type="radio" value="2anos"/> 2 anos<br/>
				<input name="question7" type="radio" value="4anos"/> 4 anos<br/>
				<input name="question7" type="radio" value="5anos"/> 5 anos<br/>
                <input name="question7" type="radio" value="nao_sei"/> Não sei<br/>
			</div>
            <br>
            <p>Cargo Hugo Motta?</p>
            <div>
				<input name="question9" type="radio" value="presidente_camara"/> Pres. Câmara<br/>
				<input name="question9" type="radio" value="presidente_senado"/> Pres. Senado<br/>
				<input name="question9" type="radio" value="ministro_stf"/> Ministro STF<br/>
                <input name="question9" type="radio" value="nao_sei"/> Não sei<br/>
			</div>
		</div>

		<div class="survey-page" id="page-12" style="display: none;">
			<p>Para demonstrar que você está lendo com atenção, selecione "Julgar crimes" abaixo.</p>
			<div>
				<input name="question8" type="radio" value="criar_revisar_leis"/> Criar leis<br/>
				<input name="question8" type="radio" value="julgar_crimes"/> Julgar crimes<br/>
				<input name="question8" type="radio" value="sentencas_constitucionais"/> Definir sentenças<br/>
			</div>
		</div>

		<div id="navigation-buttons" style="margin-top: 20px;">
            <div id="loading-spinner" style="display:none; color:blue;">Aguarde...</div>
			<button id="next-button" onclick="handleNextButton()" style="padding: 10px 20px; font-size: 16px;">Avançar</button>
		</div>
	</div>

    <div id="description" style="text-align: center; margin-bottom: 20px; display: none;">
        <p style="font-size: 18px; color: #555;"><b>Primeiro, por favor responda.</b></p>
    </div>

    <div id="question-box" style="display: none; text-align: center; margin-top: 20px; margin-bottom: 30px;">
        <p id="final-question" style="font-weight:bold;">Qual sua opinião sobre a proposta acima?</p>
        <div id="ai-scale" style="display: flex; justify-content: center; gap: 24px; margin-bottom: 16px; flex-wrap: wrap;">
            <label><input type="radio" name="ai_vote" value="discordo_fortemente"> Discordo fortemente</label>
            <label><input type="radio" name="ai_vote" value="discordo"> Discordo</label>
            <label><input type="radio" name="ai_vote" value="neutro"> Neutro</label>
            <label><input type="radio" name="ai_vote" value="concordo"> Concordo</label>
            <label><input type="radio" name="ai_vote" value="concordo_fortemente"> Concordo fortemente</label>
        </div>
        <button id="submit-vote-btn" style="padding: 10px 20px;">Enviar resposta</button>
        <p id="vote-message" style="color: green; display: none;"></p>
    </div>

    <div id="timer" style="display: none;"><span style="color: red;">3:00</span></div>
    <div id="chatbox" style="display: none;"></div>
    <input id="user-input" placeholder="Digite sua mensagem..." style="display: none;" type="text"/>

    <div id="final-consultation-page" style="display: none; max-width: 800px; margin: 0 auto;">
        <div style="background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="color: #28a745; text-align: center;">A pesquisa foi concluída.</h2>
            
            <p style="font-size: 16px; line-height: 1.5; color: #555;">
                Abaixo disponibilizamos links para consultas públicas atualmente abertas no site oficial do Congresso Nacional.
                <br><br>
                Consulta pública é um mecanismo institucional por meio do qual cidadãos podem registrar sua posição (por exemplo, concordar ou discordar) sobre propostas legislativas em tramitação.
                <br><br>
                O acesso é opcional e não está vinculado à pesquisa. Ao clicar, você será redirecionado ao site oficial do Congresso Nacional (em uma nova aba).
            </p>

            <a href="https://www12.senado.leg.br/ecidadania/visualizacaomateria?id=160575" target="_blank" class="consultation-box" onclick="trackLinkClick('ANISTIA_8_JAN')">
                <span class="consultation-title">CONSULTA PÚBLICA ANISTIA 8 DE JANEIRO</span>
                <span class="consultation-url">Clique para acessar o site do Senado</span>
            </a>

            <a href="https://www12.senado.leg.br/ecidadania/visualizacaomateria?id=168114" target="_blank" class="consultation-box" onclick="trackLinkClick('SEGURANCA_PUBLICA')">
                <span class="consultation-title">CONSULTA PÚBLICA AUMENTO DOS RECURSOS DE SEGURANÇA PÚBLICA</span>
                <span class="consultation-url">Clique para acessar o site do Senado</span>
            </a>

            <a href="https://www12.senado.leg.br/ecidadania/visualizacaomateria?id=149579" target="_blank" class="consultation-box" onclick="trackLinkClick('GRANDES_FORTUNAS')">
                <span class="consultation-title">CONSULTA PÚBLICA TAXAÇÃO DE GRANDES FORTUNAS</span>
                <span class="consultation-url">Clique para acessar o site do Senado</span>
            </a>

            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

            <div style="text-align: center;">
                <p style="font-size: 14px; color: #777; margin-bottom: 15px;">
                    Para registrar sua participação e receber seus créditos, clique no botão abaixo:
                </p>
                <button onclick="redirectUser('COMPLETE')" style="background-color: #28a745; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 5px; cursor: pointer;">
                    Finalizar e Encerrar Pesquisa
                </button>
            </div>
        </div>
    </div>

</div>

<div id="disqualification-section" style="display: none; text-align: center; margin-top: 100px;">
    <p>Redirecionando...</p>
</div>

<script>
    // --- URLs ---
    const REDIRECT_URLS = {
        COMPLETE: "https://www.surveytaking.com/processsurvey.php?status=complete&owid=",
        SCREENED: "https://www.surveytaking.com/processsurvey.php?status=screened&owid=",
        QUOTA_FULL: "https://www.surveytaking.com/processsurvey.php?status=quotafull&owid=",
        QUALITY_SCREENED: "https://www.surveytaking.com/processsurvey.php?status=qualscreen&owid="
    };

    // --- CONFIGURAÇÃO ---
    let prolificPID = new URLSearchParams(window.location.search).get('owid') || 
                      new URLSearchParams(window.location.search).get('PROLIFIC_PID') || 
                      'test_' + Math.floor(Math.random()*10000);
    
    // URL do Backend (Ajuste se necessário)
    const BACKEND_URL = 'https:///llm-survey-721553078439.us-east1.run.app/';

    function redirectUser(statusType) {
        window.location.href = REDIRECT_URLS[statusType] + prolificPID;
    }

    function trackLinkClick(linkName) {
        fetch(BACKEND_URL + '/track_click', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                prolificPID: prolificPID,
                link_name: linkName
            })
        }).catch(err => console.error("Erro ao rastrear clique", err));
    }

    // --- CATEGORIAS (EXPERIMENTO) ---
    let categories = [
        {
            name: "Anistia",
            questions: [
                "Pessoas condenadas pelos ataques de 8 de janeiro de 2023 deveriam ser presas.",
                "O governo deveria conceder anistia às pessoas envolvidas nos protestos de 8 de janeiro de 2023."
            ],
            default: [
                "Esta proposta envolve punir de forma rigorosa pessoas condenadas pelos ataques de 8 de janeiro.\n\nArgumentos a favor citam responsabilidade e Estado de Direito. Argumentos contra citam penas excessivas e pacificação.",
                "Esta proposta trata da anistia aos envolvidos no 8 de janeiro.\n\nArgumentos a favor citam reconciliação nacional. Argumentos contra citam impunidade e risco à democracia."
            ]
        },
        {
            name: "Segurança pública",
            questions: [
                "Operações policiais em favelas deveriam ser suspensas.",
                "O governo deveria aumentar o policiamento nas ruas."
            ],
            default: [
                "Suspender operações em favelas visa proteger moradores de confrontos, mas críticos dizem que fortalece o crime.",
                "Aumentar policiamento visa reduzir criminalidade visível, mas críticos alertam para abusos se não houver treinamento."
            ]
        },
        {
            name: "Economia",
            questions: [
                "O Brasil deveria aumentar impostos sobre grandes fortunas.",
                "Pessoas que ganham até R$5.000,00 por mês deveriam ser isentas de pagar imposto de renda."
            ],
            default: [
                "Taxar grandes fortunas pode reduzir desigualdade, mas críticos temem fuga de capital.",
                "Isentar até R$5.000 alivia a classe média, mas reduz arrecadação do governo."
            ]
        }
    ];

    // Embaralhar categorias
    categories = categories.sort(() => Math.random() - 0.5);

    // --- ESTADO ---
    let currentPage = 1;
    const TOTAL_PAGES_FORM = 12; 
    let currentCategoryIndex = 0;
    let currentQuestion = "";
    let showChatbox = false;
    let conversationHistory = [];
    let timerInterval = null;
    let isAI = false; 

    // Determinar Grupo IA (50/50)
    isAI = Math.random() < 0.5;
    console.log("Modo IA:", isAI);

    // --- NAVEGAÇÃO ---
    async function handleNextButton() {
        const btn = document.getElementById('next-button');
        const spinner = document.getElementById('loading-spinner');
        
        // Validação básica
        if (!validateCurrentPage()) return;

        // Verifica Cotas (Assíncrono) - P2 (Gênero), P3 (Região), P4 (Idade)
        if (currentPage === 2 || currentPage === 3 || currentPage === 4) {
            btn.style.display = 'none';
            spinner.style.display = 'block';
            
            const quotaFull = await checkQuotaForCurrentPage();
            
            spinner.style.display = 'none';
            btn.style.display = 'inline-block';

            if (quotaFull) {
                redirectUser("QUOTA_FULL");
                return;
            }
        }

        // Verifica Attention Check (Página 12)
        if (currentPage === 12) {
            const q8 = document.querySelector('input[name="question8"]:checked').value;
            if (q8 !== "julgar_crimes") {
                redirectUser("QUALITY_SCREENED");
                return;
            }
        }

        // Q2 lógica para mostrar Q3 (Página 9)
        if (currentPage === 9) {
            const q2 = document.querySelector('input[name="question2"]:checked').value;
            const q3Div = document.getElementById('q3-container');
            if (q2 === 'votou_1e2' || q2 === 'votou_2') {
                q3Div.style.display = 'block';
                // Verifica se já respondeu Q3
                if (!document.querySelector('input[name="question3"]:checked')) {
                    // Se acabou de mostrar, não avança.
                    if (q3Div.dataset.shown !== "true") {
                        q3Div.dataset.shown = "true";
                        return; 
                    } else {
                        alert("Por favor responda em quem votou.");
                        return;
                    }
                }
            }
        }

        // Avançar página
        document.getElementById(`page-${currentPage}`).style.display = 'none';
        currentPage++;

        if (currentPage <= TOTAL_PAGES_FORM) {
            document.getElementById(`page-${currentPage}`).style.display = 'block';
        } else {
            // Fim do form, iniciar Experimento
            document.getElementById('survey-questions').style.display = 'none';
            document.getElementById('instructions').style.display = 'block';
        }
    }

    function validateCurrentPage() {
        // Validações simples para inputs visíveis
        const activePage = document.getElementById(`page-${currentPage}`);
        const checked = activePage.querySelector('input[type="radio"]:checked');
        
        // P1 Screenout
        if (currentPage === 1) {
            if (!checked) { alert("Selecione uma opção."); return false; }
            if (checked.value === 'br_under18' || checked.value === 'not_brazilian') {
                redirectUser("SCREENED");
                return false;
            }
        }
        
        // Validação da Tabela de IA (Página 7)
        if (currentPage === 7) {
            const groups = ["q_ai_preference", "q_ai_better_worker", "q_ai_discomfort", "q_ai_control", "q_ai_trivial"];
            for (let name of groups) {
                if (!activePage.querySelector(`input[name="${name}"]:checked`)) {
                    alert("Por favor, responda a todas as linhas da tabela.");
                    return false;
                }
            }
            return true;
        }

        // Validação genérica para rádio obrigatório (se houver radios na página)
        if (activePage.querySelectorAll('input[type="radio"]').length > 0 && !checked) {
             // Exceção P9 que tem Q3 hidden
             if (currentPage !== 9) { 
                 alert("Por favor, responda a pergunta."); return false; 
             }
        }
        return true;
    }

    // --- CHECK COTA BACKEND ---
    async function checkQuotaForCurrentPage() {
        let category = "";
        let value = "";

        if (currentPage === 2) { // Gênero
            category = "genero";
            value = document.querySelector('input[name="demo_genero"]:checked').value;
        } else if (currentPage === 3) { // Região
            category = "regiao";
            value = document.querySelector('input[name="demo_regiao"]:checked').value;
        } else if (currentPage === 4) { // Idade
            category = "faixa_etaria";
            value = document.querySelector('input[name="demo_faixa_etaria"]:checked').value;
        } else {
            return false;
        }

        try {
            const res = await fetch(BACKEND_URL + '/check_quota', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ category, value })
            });
            const data = await res.json();
            return data.full;
        } catch (e) {
            console.error(e);
            return false; // Em caso de erro, deixa passar
        }
    }

    // --- EXPERIMENTO ---
    function startExperiment() {
        document.getElementById('instructions').style.display = 'none';
        document.getElementById('description').style.display = 'block';
        loadNextProposal();
    }

    function loadNextProposal() {
        if (currentCategoryIndex >= categories.length) {
            finishSurvey();
            return;
        }
        
        const cat = categories[currentCategoryIndex];
        const qIndex = Math.floor(Math.random() * cat.questions.length);
        currentQuestion = cat.questions[qIndex];
        
        // Reset UI
        document.getElementById('question-box').style.display = 'none';
        const chatbox = document.getElementById('chatbox');
        chatbox.innerHTML = '';
        conversationHistory = [];

        // Setup
        const descDiv = document.getElementById('description');
        descDiv.innerHTML = `<p><strong>Proposta:</strong> ${currentQuestion}</p>`;

        document.getElementById('timer').style.display = 'block';
        startTimer();

        if (isAI) {
            showChatbox = true;
            document.getElementById('chatbox').style.display = 'block';
            document.getElementById('user-input').style.display = 'block';
            
            appendMessage('Assistente', "Olá! Estou aqui para debater esta proposta com você.", 'assistant');
            conversationHistory.push({role: "assistant", content: "Olá! Estou aqui para debater esta proposta com você."});
            conversationHistory.push({role: "system", content: `O usuário está avaliando a proposta: "${currentQuestion}". Ajude-o a pensar sobre.`});
        } else {
            showChatbox = false;
            document.getElementById('chatbox').style.display = 'none';
            document.getElementById('user-input').style.display = 'none';
        }
    }

    function startTimer() {
        let timeLeft = 180; // 3 minutos
        const timerDiv = document.getElementById('timer');
        
        if (timerInterval) clearInterval(timerInterval);
        
        timerDiv.innerHTML = `Tempo restante: <span style='color:red'>${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}</span>`;

        timerInterval = setInterval(() => {
            timeLeft--;
            timerDiv.innerHTML = `Tempo restante: <span style='color:red'>${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}</span>`;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById('question-box').style.display = 'block';
                if(isAI) {
                    document.getElementById('user-input').disabled = true;
                }
            }
        }, 1000);
    }

    // --- CHAT ---
    const userInput = document.getElementById('user-input');
    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        appendMessage('Você', text, 'user');
        conversationHistory.push({ role: 'user', content: text });
        userInput.value = '';
        userInput.disabled = true;

        try {
            const res = await fetch(BACKEND_URL + '/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ history: conversationHistory, model: 'gpt', prolificPID: prolificPID, question: currentQuestion })
            });
            const data = await res.json();
            appendMessage('Assistente', data.response, 'assistant');
            conversationHistory.push({ role: 'assistant', content: data.response });
        } catch (err) {
            appendMessage('Erro', 'Falha na conexão.', 'assistant');
        }
        userInput.disabled = false;
        userInput.focus();
    }

    function appendMessage(sender, text, cls) {
        const div = document.createElement('div');
        div.className = `message ${cls}`;
        div.innerHTML = `<strong>${sender}:</strong> ${text}`;
        const cb = document.getElementById('chatbox');
        cb.appendChild(div);
        cb.scrollTop = cb.scrollHeight;
    }

    // --- VOTO ---
    document.getElementById('submit-vote-btn').onclick = async () => {
        const vote = document.querySelector('input[name="ai_vote"]:checked');
        if (!vote) { alert("Selecione uma opção."); return; }

        await fetch(BACKEND_URL + '/vote', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                vote: vote.value,
                question: currentQuestion,
                category: categories[currentCategoryIndex].name,
                prolificPID: prolificPID,
                showChatbox: showChatbox
            })
        });

        document.querySelectorAll('input[name="ai_vote"]').forEach(r => r.checked = false);
        currentCategoryIndex++;
        loadNextProposal();
    };

    // --- FINALIZAR ---
    function finishSurvey() {
        const payload = collectAllData();
        
        fetch(BACKEND_URL + '/survey', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        }).then(() => {
            showFinalPage();
        }).catch(err => {
            console.error("Erro ao salvar survey", err);
            showFinalPage();
        });
    }

    function showFinalPage() {
        // Esconde tudo relacionado ao experimento
        document.getElementById('description').style.display = 'none';
        document.getElementById('question-box').style.display = 'none';
        document.getElementById('chatbox').style.display = 'none';
        document.getElementById('timer').style.display = 'none';
        document.getElementById('user-input').style.display = 'none';
        document.querySelector('.survey-container').style.display = 'none'; 

        // Mostra a página final
        document.getElementById('final-consultation-page').style.display = 'block';
    }

    function collectAllData() {
        const getVal = (name) => document.querySelector(`input[name="${name}"]:checked`)?.value;
        
        return {
            prolificPID: prolificPID,
            question1: getVal('question1'),
            demografia: {
                genero: getVal('demo_genero'),
                regiao: getVal('demo_regiao'),
                faixa_etaria: getVal('demo_faixa_etaria'),
                cor: getVal('demo_cor'),
                renda: getVal('demo_renda'),
                religiao: getVal('demo_religiao'),
                escolaridade: getVal('demo_escolaridade')
            },
            q_ai: {
                preference: getVal('q_ai_preference'),
                better_worker: getVal('q_ai_better_worker'),
                discomfort: getVal('q_ai_discomfort'),
                control: getVal('q_ai_control'),
                trivial: getVal('q_ai_trivial')
            },
            question2: getVal('question2'),
            question3: getVal('question3'),
            question4: getVal('question4'),
            question6: getVal('question6'),
            question7: getVal('question7'),
            question8: getVal('question8'),
            question9: getVal('question9'),
            question5: {
                q5_jornal_diario: getVal('q5_jornal_diario'),
                q5_jornais_tv: getVal('q5_jornais_tv'),
                q5_jornais_radio: getVal('q5_jornais_radio'),
                q5_redes_sociais: getVal('q5_redes_sociais'),
                q5_conversas: getVal('q5_conversas'),
                q5_ia: getVal('q5_ia')
            }
        };
    }

    // Consent Buttons
    window.acceptConsent = () => {
        document.getElementById('consent-section').style.display = 'none';
        document.querySelector('.survey-container').style.display = 'flex';
        document.getElementById('survey-questions').style.display = 'block';
    };
    window.declineConsent = () => {
        document.getElementById('consent-section').innerHTML = "<h3>Obrigado.</h3>";
    };
</script>

</body>
</html>