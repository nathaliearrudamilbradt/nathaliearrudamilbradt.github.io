<!DOCTYPE html>
<html lang="pt-BR">
<head>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Pesquisa de Opinião</title>
<style>
	body { font-family: 'Arial', sans-serif; margin: 20px; background: #f4f4f4; color: #333; }
	h1 { text-align: center; color: #444; }
	#timer { font-size: 18px; color: #000; text-align: center; margin-bottom: 10px; }
	#chatbox {
		border: 2px solid #ddd; border-radius: 10px; padding: 15px; background: #fff;
		height: 400px; overflow-y: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
		margin-bottom: 10px; font-size: 16px; white-space: pre-wrap; word-wrap: break-word;
	}
	#user-input {
		width: calc(100% - 80px); padding: 10px; font-size: 16px; border: 2px solid #ddd;
		border-radius: 20px; outline: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
	}
	.message { margin: 10px 0; padding: 10px; border-radius: 10px; max-width: 80%; line-height: 1.5; }
	.user { background: #cce5ff; align-self: flex-end; color: #004085; text-align: right; margin-left: auto; }
	.assistant { background: #f8d7da; align-self: flex-start; color: #721c24; text-align: left; margin-right: auto; }
	#description p {
		font-size: 18px; color: #333; background-color: #f9f9f9; padding: 15px;
		border: 1px solid #ddd; border-radius: 10px; margin: 0 auto; max-width: 700px;
	}
	.survey-container {
		display: flex; justify-content: center; align-items: center;
		background-color: #f9f9f9; margin: 0 auto; max-width: 800px; padding: 20px; display: none;
	}
    
    /* --- CSS PARA CLIQUE NO TEXTO (NOVO) --- */
    .option-label {
        display: block; /* Ocupa a linha inteira */
        padding: 8px 5px; /* Espaço para clique */
        margin-bottom: 5px;
        cursor: pointer; /* Mãozinha */
        font-size: 16px;
    }
    .option-label:hover {
        background-color: #e9ecef; /* Feedback visual ao passar o mouse */
        border-radius: 5px;
    }
    .option-label input[type="radio"] {
        margin-right: 10px;
        transform: scale(1.2); /* Aumenta um pouco o botão */
    }

    /* Estilos da Escala Responsiva (1-10) */
    .scale-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; }
    .scale-options { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    
    /* Estilo para Tabela Likert (IA) */
    .likert-table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .likert-table th, .likert-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .likert-table th { background-color: #eee; }
    .likert-row-label { text-align: left !important; width: 40%; }
    /* Clique na célula da tabela */
    .likert-table td label { display: block; width: 100%; height: 100%; cursor: pointer; } 

    /* Estilo para a votação do Experimento (Vertical) */
    .ai-vote-container {
        display: flex; flex-direction: column; gap: 12px; max-width: 500px; margin: 0 auto;
    }
    .ai-vote-option {
        display: flex; align-items: center; padding: 12px 15px; border: 1px solid #ddd;
        border-radius: 8px; background-color: #fff; cursor: pointer; transition: background-color 0.2s; text-align: left;
    }
    .ai-vote-option:hover { background-color: #e9ecef; }
    .ai-vote-option input { margin-right: 12px; transform: scale(1.2); }
    .ai-vote-option span { font-size: 16px; }

    /* Estilo para as caixas de Consulta Pública (Final) */
    .consultation-box {
        display: block; background-color: #fff; border: 2px solid #004085;
        border-radius: 8px; padding: 20px; margin: 15px 0; text-decoration: none;
        color: #333; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;
    }
    .consultation-box:hover {
        transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        background-color: #f0f8ff;
    }
    .consultation-title {
        font-weight: bold; color: #0056b3; font-size: 16px; margin-bottom: 5px; display: block;
    }
    .consultation-url { font-size: 12px; color: #666; display: block; }

    @media (max-width: 600px) {
        .scale-options { flex-wrap: nowrap; overflow-x: auto; justify-content: flex-start; width: 100%; padding-bottom: 10px; }
        .scale-options label { flex: 0 0 auto; min-width: 30px; }
        
        .likert-table { font-size: 12px; }
        .likert-table th, .likert-table td { padding: 4px; }
    }
</style>
</head>
<body>

<div id="consent-section" style="margin-top: 50px;">
	<p style="font-size: 18px; color: #555; line-height: 1.5; margin-bottom: 20px;">
		<strong>Termo de consentimento </strong><br><br>
		Você está sendo convidado(a) a participar de um estudo de pesquisa acadêmica. Sua participação é totalmente voluntária.
		<br><br>
		<b>Propósito da Pesquisa.</b><br>
		Este estudo faz parte de uma pesquisa acadêmica cujo objetivo é entender melhor como modelos de inteligência artificial podem influenciar opiniões e raciocínio político. Você está sendo convidado(a) porque tem mais de 18 anos e é brasileiro(a).
		<br><br>
		<b>Procedimentos.</b><br>
		Durante o estudo, você verá uma série de cenários políticos hipotéticos e responderá perguntas sobre eles. Em alguns casos, poderá ser convidado(a) a interagir por alguns minutos com uma ferramenta automatizada com inteligência artificial antes de responder às perguntas. Ao final, você será solicitado(a) a registrar sua opinião.
		<br><br>
		<b>Duração.</b><br>
		A participação envolverá aproximadamente 10 minutos do seu tempo.
		<br><br>
		<b>Riscos e Benefícios.</b><br>
		Não esperamos riscos associados à sua participação. Você não receberá benefícios diretos, mas contribuirá para a ciência.
		<br><br>
		<b>Privacidade.</b><br>
		Todas as suas respostas serão mantidas 100% confidenciais e anônimas.
		<br><br>
		Em caso de dúvidas: <i>Nathalie Arruda Milbradt (nathaliearrudamilbradt@college.harvard.edu)</i>
	</p>
	<button onclick="acceptConsent()" style="margin-right: 10px; padding: 10px 20px; font-size: 18px; cursor: pointer;">Aceito os termos</button>
    <button onclick="declineConsent()" style="padding: 10px 20px; font-size: 18px; cursor: pointer;">Recuso os termos</button>
</div>

<div id="instructions" style="margin-top: 50px; display: none;">
	<p style="font-size: 18px; color: #555; line-height: 1.5; margin-bottom: 20px;">
		Em seguida, vamos apresentar algumas <strong>propostas políticas</strong>.
		<br><br>
		Para ajudar na decisão, em alguns casos você poderá conversar com um <strong>assistente de inteligência artificial (IA)</strong>.
		<br><br>
		Quando o chatbot estiver disponível, pedimos que você converse com ele por <strong>pelo menos 3 minutos</strong>.
	</p>
	<button onclick="startExperiment()" style="margin-right: 10px; padding: 10px 20px; font-size: 18px; cursor: pointer;">Iniciar</button>
</div>

<div class="survey-container">
	<div id="survey-questions" style="display: none; text-align: left; margin-top: 20px; width: 100%;">
        
        <div class="survey-page" id="page-1" style="display: block;">
			<p>Qual das opções descreve melhor você?</p>
			<div style="text-align: left;">
				<label class="option-label"><input id="q1_opt1" name="question1" type="radio" value="br_18plus"/> Sou brasileira(o) e tenho 18 anos ou mais</label>
				<label class="option-label"><input id="q1_opt2" name="question1" type="radio" value="br_under18"/> Sou brasileira(o) e tenho menos de 18 anos</label>
				<label class="option-label"><input id="q1_opt3" name="question1" type="radio" value="not_brazilian"/> Não sou brasileira(o)</label>
			</div>
		</div>

        <div class="survey-page" id="page-2" style="display: none;">
			<p>Qual é o seu gênero?</p>
			<div style="text-align: left;">
				<label class="option-label"><input name="demo_genero" type="radio" value="feminino"/> Feminino</label>
				<label class="option-label"><input name="demo_genero" type="radio" value="masculino"/> Masculino</label>
				<label class="option-label"><input name="demo_genero" type="radio" value="outro"/> Outro</label>
				<label class="option-label"><input name="demo_genero" type="radio" value="prefiro_nao_responder"/> Prefiro não responder</label>
			</div>
		</div>

        <div class="survey-page" id="page-3" style="display: none;">
			<p>Em qual região do Brasil você mora atualmente?</p>
			<div style="text-align: left;">
				<label class="option-label"><input name="demo_regiao" type="radio" value="norte"/> Norte</label>
				<label class="option-label"><input name="demo_regiao" type="radio" value="nordeste"/> Nordeste</label>
				<label class="option-label"><input name="demo_regiao" type="radio" value="centro_oeste"/> Centro-Oeste</label>
				<label class="option-label"><input name="demo_regiao" type="radio" value="sudeste"/> Sudeste</label>
				<label class="option-label"><input name="demo_regiao" type="radio" value="sul"/> Sul</label>
			</div>
		</div>

        <div class="survey-page" id="page-4" style="display: none;">
			<p>Qual é a sua faixa etária?</p>
			<div style="text-align: left;">
				<label class="option-label"><input name="demo_faixa_etaria" type="radio" value="18_24"/> 18 a 24 anos</label>
				<label class="option-label"><input name="demo_faixa_etaria" type="radio" value="25_34"/> 25 a 34 anos</label>
				<label class="option-label"><input name="demo_faixa_etaria" type="radio" value="35_44"/> 35 a 44 anos</label>
				<label class="option-label"><input name="demo_faixa_etaria" type="radio" value="45_54"/> 45 a 54 anos</label>
				<label class="option-label"><input name="demo_faixa_etaria" type="radio" value="55_mais"/> 55 anos ou mais</label>
			</div>
		</div>

        <div class="survey-page" id="page-5" style="display: none;">
			<p>Como você se autodeclara em termos de cor ou raça?</p>
			<div>
				<label class="option-label"><input name="demo_cor" type="radio" value="branca"/> Branca</label>
				<label class="option-label"><input name="demo_cor" type="radio" value="preta"/> Preta</label>
				<label class="option-label"><input name="demo_cor" type="radio" value="parda"/> Parda</label>
				<label class="option-label"><input name="demo_cor" type="radio" value="amarela"/> Amarela</label>
				<label class="option-label"><input name="demo_cor" type="radio" value="indigena"/> Indígena</label>
				<label class="option-label"><input name="demo_cor" type="radio" value="outra"/> Outra</label>
			</div>
        </div>

        <div class="survey-page" id="page-6" style="display: none;">
            <p>Qual é a renda mensal total do seu domicílio (somando todas as pessoas que contribuem com renda)?</p>
			<div>
				<label class="option-label"><input name="demo_renda" type="radio" value="ate_1sm"/> Até 1 salário mínimo</label>
				<label class="option-label"><input name="demo_renda" type="radio" value="1a2sm"/> Entre 1 e 2 salários mínimos</label>
				<label class="option-label"><input name="demo_renda" type="radio" value="2a5sm"/> Entre 2 e 5 salários mínimos</label>
				<label class="option-label"><input name="demo_renda" type="radio" value="5a10sm"/> Entre 5 e 10 salários mínimos</label>
				<label class="option-label"><input name="demo_renda" type="radio" value="mais_10sm"/> Mais de 10 salários mínimos</label>
			</div>
		</div>

        <div class="survey-page" id="page-7" style="display: none;">
			<p>Qual é a sua religião?</p>
			<div>
				<label class="option-label"><input name="demo_religiao" type="radio" value="catolica"/> Católica</label>
				<label class="option-label"><input name="demo_religiao" type="radio" value="evangelica_pentecostal"/> Evangélica – Pentecostal</label>
				<label class="option-label"><input name="demo_religiao" type="radio" value="evangelica_nao_pentecostal"/> Evangélica – Não pentecostal</label>
				<label class="option-label"><input name="demo_religiao" type="radio" value="espirita"/> Espírita</label>
				<label class="option-label"><input name="demo_religiao" type="radio" value="umbanda_candomble"/> Umbanda / Candomblé</label>
				<label class="option-label"><input name="demo_religiao" type="radio" value="outra"/> Outra religião</label>
				<label class="option-label"><input name="demo_religiao" type="radio" value="sem_religiao"/> Sem religião</label>
			</div>
        </div>

        <div class="survey-page" id="page-8" style="display: none;">
            <p>Qual o nível mais alto de escolaridade que você completou?</p>
			<div>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="fundamental_incompleto"/> Ensino fundamental incompleto</label>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="fundamental_completo"/> Ensino fundamental completo</label>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="medio_incompleto"/> Ensino médio incompleto</label>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="medio_completo"/> Ensino médio completo</label>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="superior_incompleto"/> Ensino superior incompleto</label>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="superior_completo"/> Ensino superior completo</label>
				<label class="option-label"><input name="demo_escolaridade" type="radio" value="pos_graduacao"/> Pós-graduação</label>
			</div>
		</div>

        <div class="survey-page" id="page-9" style="display: none;">
            <p>Para cada uma das afirmações abaixo, indique o quanto você concorda ou discorda:</p>
            <table class="likert-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>Discordo totalmente</th>
                        <th>Discordo</th>
                        <th>Neutro</th>
                        <th>Concordo</th>
                        <th>Concordo totalmente</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="likert-row-label">Para transações rotineiras, eu preferiria interagir com um sistema de inteligência artificial em vez de um ser humano.</td>
                        <td><label><input type="radio" name="q_ai_preference" value="1"></label></td>
                        <td><label><input type="radio" name="q_ai_preference" value="2"></label></td>
                        <td><label><input type="radio" name="q_ai_preference" value="3"></label></td>
                        <td><label><input type="radio" name="q_ai_preference" value="4"></label></td>
                        <td><label><input type="radio" name="q_ai_preference" value="5"></label></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">Um agente de inteligência artificial seria melhor do que um funcionário em muitos trabalhos rotineiros.</td>
                        <td><label><input type="radio" name="q_ai_better_worker" value="1"></label></td>
                        <td><label><input type="radio" name="q_ai_better_worker" value="2"></label></td>
                        <td><label><input type="radio" name="q_ai_better_worker" value="3"></label></td>
                        <td><label><input type="radio" name="q_ai_better_worker" value="4"></label></td>
                        <td><label><input type="radio" name="q_ai_better_worker" value="5"></label></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">Eu sinto desconforto quando penso nos usos futuros da inteligência artificial.</td>
                        <td><label><input type="radio" name="q_ai_discomfort" value="1"></label></td>
                        <td><label><input type="radio" name="q_ai_discomfort" value="2"></label></td>
                        <td><label><input type="radio" name="q_ai_discomfort" value="3"></label></td>
                        <td><label><input type="radio" name="q_ai_discomfort" value="4"></label></td>
                        <td><label><input type="radio" name="q_ai_discomfort" value="5"></label></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">A inteligência artificial pode vir a assumir o controle das pessoas.</td>
                        <td><label><input type="radio" name="q_ai_control" value="1"></label></td>
                        <td><label><input type="radio" name="q_ai_control" value="2"></label></td>
                        <td><label><input type="radio" name="q_ai_control" value="3"></label></td>
                        <td><label><input type="radio" name="q_ai_control" value="4"></label></td>
                        <td><label><input type="radio" name="q_ai_control" value="5"></label></td>
                    </tr>
                    <tr>
                        <td class="likert-row-label">Sistemas de inteligência artificial deveriam ser usados apenas para assuntos sem importância.</td>
                        <td><label><input type="radio" name="q_ai_trivial" value="1"></label></td>
                        <td><label><input type="radio" name="q_ai_trivial" value="2"></label></td>
                        <td><label><input type="radio" name="q_ai_trivial" value="3"></label></td>
                        <td><label><input type="radio" name="q_ai_trivial" value="4"></label></td>
                        <td><label><input type="radio" name="q_ai_trivial" value="5"></label></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="survey-page" id="page-10" style="display:none;">
			<h2>Informações Importantes</h2>
			<p>
				As próximas perguntas têm como objetivo compreender padrões de comportamento político.
				Suas respostas são totalmente anônimas.
			</p>
		</div>

        <div class="survey-page" id="page-11" style="display: none;">
			<p>Na eleição de 2022 para presidente, você:</p>
			<div>
				<label class="option-label"><input name="question2" type="radio" value="votou_1e2"/> Votou no 1º e no 2º turno</label>
				<label class="option-label"><input name="question2" type="radio" value="votou_1"/> Votou somente no 1º turno</label>
				<label class="option-label"><input name="question2" type="radio" value="votou_2"/> Votou somente no 2º turno</label>
				<label class="option-label"><input name="question2" type="radio" value="nao_votou"/> Não votou em nenhum turno</label>
				<label class="option-label"><input name="question2" type="radio" value="nao_podia_votar"/> Não podia votar na época</label>
			</div>
		</div>

        <div class="survey-page" id="page-12" style="display: none;">
            <p>Em quem você votou para presidente no segundo turno da eleição de 2022?</p>
            <div>
                <label class="option-label"><input name="question3" type="radio" value="lula"/> Luiz Inácio Lula da Silva (PT)</label>
                <label class="option-label"><input name="question3" type="radio" value="bolsonaro"/> Jair Bolsonaro (PL)</label>
                <label class="option-label"><input name="question3" type="radio" value="branco_nulo"/> Votei em branco / nulo</label>
                <label class="option-label"><input name="question3" type="radio" value="nao_compareci"/> Não votei / não compareci</label>
                <label class="option-label"><input name="question3" type="radio" value="prefiro_nao_responder"/> Prefiro não responder</label>
            </div>
        </div>

        <div class="survey-page" id="page-13" style="display: none;">
			<p>Em uma escala de 1 a 10, na qual 1 significa “esquerda” e 10 significa “direita”, onde você diria que suas opiniões políticas se encaixam melhor?</p>
			<div class="scale-options">
                <label><input type="radio" name="question4" value="1">1</label>
                <label><input type="radio" name="question4" value="2">2</label>
                <label><input type="radio" name="question4" value="3">3</label>
                <label><input type="radio" name="question4" value="4">4</label>
                <label><input type="radio" name="question4" value="5">5</label>
                <label><input type="radio" name="question4" value="6">6</label>
                <label><input type="radio" name="question4" value="7">7</label>
                <label><input type="radio" name="question4" value="8">8</label>
                <label><input type="radio" name="question4" value="9">9</label>
                <label><input type="radio" name="question4" value="10">10</label>
            </div>
		</div>

        <div class="survey-page" id="page-14" style="display: none;">
            <p>Frequência de uso de fontes de informação:</p>
            <table style="width:100%; font-size:14px;">
                <tr><th>Fonte</th><th>Dia</th><th>Sem</th><th>Mês</th><th>Raro</th><th>Nunca</th></tr>
                <tr><td>Jornal diário</td><td><label><input type="radio" name="q5_jornal_diario" value="diariamente"></label></td><td><label><input type="radio" name="q5_jornal_diario" value="semanalmente"></label></td><td><label><input type="radio" name="q5_jornal_diario" value="mensalmente"></label></td><td><label><input type="radio" name="q5_jornal_diario" value="menos_que_mensalmente"></label></td><td><label><input type="radio" name="q5_jornal_diario" value="nunca"></label></td></tr>
                <tr><td>Jornais de TV</td><td><label><input type="radio" name="q5_jornais_tv" value="diariamente"></label></td><td><label><input type="radio" name="q5_jornais_tv" value="semanalmente"></label></td><td><label><input type="radio" name="q5_jornais_tv" value="mensalmente"></label></td><td><label><input type="radio" name="q5_jornais_tv" value="menos_que_mensalmente"></label></td><td><label><input type="radio" name="q5_jornais_tv" value="nunca"></label></td></tr>
                <tr><td>Rádio</td><td><label><input type="radio" name="q5_jornais_radio" value="diariamente"></label></td><td><label><input type="radio" name="q5_jornais_radio" value="semanalmente"></label></td><td><label><input type="radio" name="q5_jornais_radio" value="mensalmente"></label></td><td><label><input type="radio" name="q5_jornais_radio" value="menos_que_mensalmente"></label></td><td><label><input type="radio" name="q5_jornais_radio" value="nunca"></label></td></tr>
                <tr><td>Redes sociais</td><td><label><input type="radio" name="q5_redes_sociais" value="diariamente"></label></td><td><label><input type="radio" name="q5_redes_sociais" value="semanalmente"></label></td><td><label><input type="radio" name="q5_redes_sociais" value="mensalmente"></label></td><td><label><input type="radio" name="q5_redes_sociais" value="menos_que_mensalmente"></label></td><td><label><input type="radio" name="q5_redes_sociais" value="nunca"></label></td></tr>
                <tr><td>Conversas</td><td><label><input type="radio" name="q5_conversas" value="diariamente"></label></td><td><label><input type="radio" name="q5_conversas" value="semanalmente"></label></td><td><label><input type="radio" name="q5_conversas" value="mensalmente"></label></td><td><label><input type="radio" name="q5_conversas" value="menos_que_mensalmente"></label></td><td><label><input type="radio" name="q5_conversas" value="nunca"></label></td></tr>
                <tr><td>IA (ChatGPT)</td><td><label><input type="radio" name="q5_ia" value="diariamente"></label></td><td><label><input type="radio" name="q5_ia" value="semanalmente"></label></td><td><label><input type="radio" name="q5_ia" value="mensalmente"></label></td><td><label><input type="radio" name="q5_ia" value="menos_que_mensalmente"></label></td><td><label><input type="radio" name="q5_ia" value="nunca"></label></td></tr>
            </table>
        </div>

        <div class="survey-page" id="page-15" style="display: none;">
			<p>Quem é responsável por julgar se uma lei é constitucional no Brasil?</p>
			<div>
				<label class="option-label"><input name="question6" type="radio" value="camara"/> Câmara dos Deputados</label>
				<label class="option-label"><input name="question6" type="radio" value="senado"/> Senado Federal</label>
				<label class="option-label"><input name="question6" type="radio" value="stf"/> Supremo Tribunal Federal (STF)</label>
				<label class="option-label"><input name="question6" type="radio" value="presidencia"/> Presidência da República</label>
                <label class="option-label"><input name="question6" type="radio" value="nao_sei"/> Não sei / Não lembro</label>
			</div>
        </div>

        <div class="survey-page" id="page-16" style="display: none;">
            <p>Com que frequência ocorrem eleições gerais (para presidente, governadores, deputados e senadores)?</p>
            <div>
				<label class="option-label"><input name="question7" type="radio" value="2anos"/> A cada 2 anos</label>
				<label class="option-label"><input name="question7" type="radio" value="4anos"/> A cada 4 anos</label>
				<label class="option-label"><input name="question7" type="radio" value="5anos"/> A cada 5 anos</label>
                <label class="option-label"><input name="question7" type="radio" value="6anos"/> A cada 6 anos</label>
                <label class="option-label"><input name="question7" type="radio" value="nao_sei"/> Não sei / Não lembro</label>
			</div>
        </div>

        <div class="survey-page" id="page-17" style="display: none;">
            <p>Você sabe qual cargo Hugo Motta ocupa atualmente?</p>
            <div>
				<label class="option-label"><input name="question9" type="radio" value="presidente_camara"/> Presidente da Câmara dos Deputados</label>
				<label class="option-label"><input name="question9" type="radio" value="presidente_senado"/> Presidente do Senado Federal</label>
				<label class="option-label"><input name="question9" type="radio" value="ministro_stf"/> Ministro do STF</label>
                <label class="option-label"><input name="question9" type="radio" value="nao_sei"/> Não sei / Não lembro</label>
			</div>
		</div>

		<div class="survey-page" id="page-18" style="display: none;">
			<p>Para demonstrar que você está lendo as perguntas com atenção, por favor selecione a opção "Julgar crimes" abaixo.</p>
			<div>
				<label class="option-label"><input name="question8" type="radio" value="criar_revisar_leis"/> Criar e revisar leis</label>
				<label class="option-label"><input name="question8" type="radio" value="julgar_crimes"/> Julgar crimes</label>
				<label class="option-label"><input name="question8" type="radio" value="sentencas_constitucionais"/> Definir sentenças constitucionais</label>
                <label class="option-label"><input name="question8" type="radio" value="orcamento_estados_municipios"/> Administrar o orçamento de estados e municípios</label>
                <label class="option-label"><input name="question8" type="radio" value="nao_sei"/> Não sei / Não lembro</label>
			</div>
		</div>

		<div id="navigation-buttons" style="margin-top: 20px;">
            <div id="loading-spinner" style="display:none; color:blue;">Verificando cota...</div>
			<button id="next-button" onclick="handleNextButton()" style="padding: 10px 20px; font-size: 16px;">Avançar</button>
		</div>
	</div>

    <div id="description" style="text-align: center; margin-bottom: 20px; display: none;">
        <p style="font-size: 18px; color: #555;"><b>Primeiro, por favor responda.</b></p>
    </div>

    <div id="question-box" style="display: none; text-align: center; margin-top: 20px; margin-bottom: 30px;">
        <p id="final-question" style="font-weight:bold;">Qual sua opinião sobre a proposta acima?</p>
        
        <div id="ai-scale" class="ai-vote-container">
            <label class="ai-vote-option">
                <input type="radio" name="ai_vote" value="discordo_fortemente">
                <span>Discordo fortemente</span>
            </label>
            <label class="ai-vote-option">
                <input type="radio" name="ai_vote" value="discordo">
                <span>Discordo</span>
            </label>
            <label class="ai-vote-option">
                <input type="radio" name="ai_vote" value="neutro">
                <span>Neutro</span>
            </label>
            <label class="ai-vote-option">
                <input type="radio" name="ai_vote" value="concordo">
                <span>Concordo</span>
            </label>
            <label class="ai-vote-option">
                <input type="radio" name="ai_vote" value="concordo_fortemente">
                <span>Concordo fortemente</span>
            </label>
        </div>

        <br>
        <button id="submit-vote-btn" style="padding: 10px 20px;">Enviar resposta</button>
        <p id="vote-message" style="color: green; display: none;"></p>
    </div>

    <div id="timer" style="display: none;"><span style="color: red;">3:00</span></div>
    <div id="chatbox" style="display: none;"></div>
    <input id="user-input" placeholder="Digite sua mensagem..." style="display: none;" type="text"/>

    <div id="final-consultation-page" style="display: none; max-width: 800px; margin: 0 auto;">
        <div style="background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="color: #28a745; text-align: center;">A pesquisa foi concluída.</h2>
            
            <p style="font-size: 16px; line-height: 1.5; color: #555;">
                Abaixo disponibilizamos links para consultas públicas atualmente abertas no site oficial do Congresso Nacional.
                <br><br>
                Consulta pública é um mecanismo institucional por meio do qual cidadãos podem registrar sua posição (por exemplo, concordar ou discordar) sobre propostas legislativas em tramitação.
                <br><br>
                O acesso é opcional e não está vinculado à pesquisa. Ao clicar, você será redirecionado ao site oficial do Congresso Nacional (em uma nova aba).
            </p>

            <a href="https://www12.senado.leg.br/ecidadania/visualizacaomateria?id=160575" target="_blank" class="consultation-box" onclick="trackLinkClick('ANISTIA_8_JAN')">
                <span class="consultation-title">CONSULTA PÚBLICA ANISTIA 8 DE JANEIRO</span>
                <span class="consultation-url">Clique para acessar o site do Senado</span>
            </a>

            <a href="https://www12.senado.leg.br/ecidadania/visualizacaomateria?id=168114" target="_blank" class="consultation-box" onclick="trackLinkClick('SEGURANCA_PUBLICA')">
                <span class="consultation-title">CONSULTA PÚBLICA AUMENTO DOS RECURSOS DE SEGURANÇA PÚBLICA</span>
                <span class="consultation-url">Clique para acessar o site do Senado</span>
            </a>

            <a href="https://www12.senado.leg.br/ecidadania/visualizacaomateria?id=149579" target="_blank" class="consultation-box" onclick="trackLinkClick('GRANDES_FORTUNAS')">
                <span class="consultation-title">CONSULTA PÚBLICA TAXAÇÃO DE GRANDES FORTUNAS</span>
                <span class="consultation-url">Clique para acessar o site do Senado</span>
            </a>

            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

            <div style="text-align: center;">
                <p style="font-size: 14px; color: #777; margin-bottom: 15px;">
                    Para registrar sua participação e receber seus créditos, clique no botão abaixo:
                </p>
                <button onclick="redirectUser('COMPLETE')" style="background-color: #28a745; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 5px; cursor: pointer;">
                    Finalizar e Encerrar Pesquisa
                </button>
            </div>
        </div>
    </div>

</div>

<div id="disqualification-section" style="display: none; text-align: center; margin-top: 100px;">
    <p>Redirecionando...</p>
</div>

<script>
    // --- URLs ---
    const REDIRECT_URLS = {
        COMPLETE: "https://www.surveytaking.com/processsurvey.php?status=complete&owid=",
        SCREENED: "https://www.surveytaking.com/processsurvey.php?status=screened&owid=",
        QUOTA_FULL: "https://www.surveytaking.com/processsurvey.php?status=quotafull&owid=",
        QUALITY_SCREENED: "https://www.surveytaking.com/processsurvey.php?status=qualscreen&owid="
    };

    // --- CONFIGURAÇÃO ---
    let prolificPID = new URLSearchParams(window.location.search).get('owid') || 
                      new URLSearchParams(window.location.search).get('PROLIFIC_PID') || 
                      'test_' + Math.floor(Math.random()*10000);
    
    // URL do Backend
    const BACKEND_URL = 'https://llm-survey-721553078439.us-east1.run.app';

    function redirectUser(statusType) {
        window.location.href = REDIRECT_URLS[statusType] + prolificPID;
    }

    function trackLinkClick(linkName) {
        fetch(BACKEND_URL + '/track_click', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                prolificPID: prolificPID,
                link_name: linkName
            })
        }).catch(err => console.error("Erro ao rastrear clique", err));
    }

    // --- CATEGORIAS (EXPERIMENTO) ---
    let categories = [
        {
            name: "Anistia",
            questions: [
                "Pessoas condenadas pelos ataques de 8 de janeiro de 2023 deveriam ser presas.",
                "O governo deveria conceder anistia às pessoas envolvidas nos protestos de 8 de janeiro de 2023."
            ],
            default: [
                "Esta proposta envolve punir de forma rigorosa pessoas condenadas pelos ataques de 8 de janeiro.\n\nArgumentos a favor citam responsabilidade e Estado de Direito. Argumentos contra citam penas excessivas e pacificação.",
                "Esta proposta trata da anistia aos envolvidos no 8 de janeiro.\n\nArgumentos a favor citam reconciliação nacional. Argumentos contra citam impunidade e risco à democracia."
            ]
        },
        {
            name: "Segurança pública",
            questions: [
                "Operações policiais em favelas deveriam ser suspensas.",
                "O governo deveria aumentar o policiamento nas ruas."
            ],
            default: [
                "Suspender operações em favelas visa proteger moradores de confrontos, mas críticos dizem que fortalece o crime.",
                "Aumentar policiamento visa reduzir criminalidade visível, mas críticos alertam para abusos se não houver treinamento."
            ]
        },
        {
            name: "Economia",
            questions: [
                "O Brasil deveria aumentar impostos sobre grandes fortunas.",
                "Pessoas que ganham até R$5.000,00 por mês deveriam ser isentas de pagar imposto de renda."
            ],
            default: [
                "Taxar grandes fortunas pode reduzir desigualdade, mas críticos temem fuga de capital.",
                "Isentar até R$5.000 alivia a classe média, mas reduz arrecadação do governo."
            ]
        }
    ];

    // Embaralhar categorias
    categories = categories.sort(() => Math.random() - 0.5);

    // --- ESTADO ---
    let currentPage = 1;
    const TOTAL_PAGES_FORM = 18; // 18 páginas de formulário
    let currentCategoryIndex = 0;
    let currentQuestion = "";
    let showChatbox = false;
    let conversationHistory = [];
    let timerInterval = null;
    let isAI = false; 

    // Determinar Grupo IA (50/50)
    isAI = Math.random() < 0.5;
    console.log("Modo IA:", isAI);

    // FUNÇÃO SKIPWAIT (Para pular timer via console)
    window.skipWait = function() {
        console.log('skipWait() called');
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        // Se houver um chatbox aberto ou question-box, libera
        const timerDiv = document.getElementById('timer');
        if (timerDiv) {
            timerDiv.innerHTML = '';
            timerDiv.style.display = 'none';
        }
        document.getElementById('question-box').style.display = 'block';
        if(isAI) {
            document.getElementById('user-input').disabled = true;
        }
    };

    // --- NAVEGAÇÃO ---
    async function handleNextButton() {
        const btn = document.getElementById('next-button');
        const spinner = document.getElementById('loading-spinner');
        
        // Validação básica
        if (!validateCurrentPage()) return;

        // Verifica Cotas (Assíncrono) - P2 (Gênero), P3 (Região), P4 (Idade)
        if (currentPage === 2 || currentPage === 3 || currentPage === 4) {
            btn.style.display = 'none';
            spinner.style.display = 'block';
            
            const quotaFull = await checkQuotaForCurrentPage();
            
            spinner.style.display = 'none';
            btn.style.display = 'inline-block';

            if (quotaFull) {
                redirectUser("QUOTA_FULL");
                return;
            }
        }

        // Verifica Attention Check (Agora na página 18)
        if (currentPage === 18) {
            const q8 = document.querySelector('input[name="question8"]:checked').value;
            if (q8 !== "julgar_crimes") {
                redirectUser("QUALITY_SCREENED");
                return;
            }
        }

        // --- LÓGICA DE NAVEGAÇÃO DE PÁGINAS ---
        const currentDiv = document.getElementById(`page-${currentPage}`);
        currentDiv.style.display = 'none';

        // Lógica para pular Q3 (P12) se necessário
        // Se está na P11 (Q2) e vai para a frente:
        if (currentPage === 11) {
            const q2 = document.querySelector('input[name="question2"]:checked').value;
            // Se NÃO votou nos dois turnos ou só no segundo, PULA a pergunta de "em quem votou no 2o turno"
            if (q2 === 'votou_1' || q2 === 'nao_votou' || q2 === 'nao_podia_votar') {
                currentPage = 13; // Pula para P13
            } else {
                currentPage = 12; // Vai para P12
            }
        } else {
            currentPage++;
        }

        if (currentPage <= TOTAL_PAGES_FORM) {
            document.getElementById(`page-${currentPage}`).style.display = 'block';
        } else {
            // Fim do form, iniciar Experimento
            document.getElementById('survey-questions').style.display = 'none';
            document.getElementById('instructions').style.display = 'block';
        }
    }

    function validateCurrentPage() {
        const activePage = document.getElementById(`page-${currentPage}`);
        const checked = activePage.querySelector('input[type="radio"]:checked');
        
        // P1 Screenout
        if (currentPage === 1) {
            if (!checked) { alert("Selecione uma opção."); return false; }
            if (checked.value === 'br_under18' || checked.value === 'not_brazilian') {
                redirectUser("SCREENED");
                return false;
            }
        }
        
        // Validação da Tabela de IA (Página 9)
        if (currentPage === 9) {
            const groups = ["q_ai_preference", "q_ai_better_worker", "q_ai_discomfort", "q_ai_control", "q_ai_trivial"];
            for (let name of groups) {
                if (!activePage.querySelector(`input[name="${name}"]:checked`)) {
                    alert("Por favor, responda a todas as linhas da tabela.");
                    return false;
                }
            }
            return true;
        }

        // Validação da Tabela de Mídia (Página 14)
        if (currentPage === 14) {
             const groups = ["q5_jornal_diario", "q5_jornais_tv", "q5_jornais_radio", "q5_redes_sociais", "q5_conversas", "q5_ia"];
             for (let name of groups) {
                if (!activePage.querySelector(`input[name="${name}"]:checked`)) {
                    alert("Por favor, responda a todas as linhas da tabela.");
                    return false;
                }
            }
            return true;
        }

        // Validação genérica para rádio obrigatório
        if (activePage.querySelectorAll('input[type="radio"]').length > 0 && !checked) {
             alert("Por favor, responda a pergunta."); return false; 
        }
        return true;
    }

    // --- CHECK COTA BACKEND ---
    async function checkQuotaForCurrentPage() {
        let category = "";
        let value = "";

        if (currentPage === 2) { // Gênero
            category = "genero";
            value = document.querySelector('input[name="demo_genero"]:checked').value;
        } else if (currentPage === 3) { // Região
            category = "regiao";
            value = document.querySelector('input[name="demo_regiao"]:checked').value;
        } else if (currentPage === 4) { // Idade
            category = "faixa_etaria";
            value = document.querySelector('input[name="demo_faixa_etaria"]:checked').value;
        } else {
            return false;
        }

        try {
            const res = await fetch(BACKEND_URL + '/check_quota', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ category, value })
            });
            const data = await res.json();
            return data.full;
        } catch (e) {
            console.error(e);
            return false; // Em caso de erro, deixa passar
        }
    }

    // --- EXPERIMENTO ---
    function startExperiment() {
        document.getElementById('instructions').style.display = 'none';
        document.getElementById('description').style.display = 'block';
        loadNextProposal();
    }

    function loadNextProposal() {
        if (currentCategoryIndex >= categories.length) {
            finishSurvey();
            return;
        }
        
        const cat = categories[currentCategoryIndex];
        const qIndex = Math.floor(Math.random() * cat.questions.length);
        currentQuestion = cat.questions[qIndex];
        
        // Reset UI
        document.getElementById('question-box').style.display = 'none';
        const chatbox = document.getElementById('chatbox');
        chatbox.innerHTML = '';
        conversationHistory = [];

        // Setup
        const descDiv = document.getElementById('description');
        descDiv.innerHTML = `<p><strong>Proposta:</strong> ${currentQuestion}</p>`;

        document.getElementById('timer').style.display = 'block';
        startTimer();

        if (isAI) {
            showChatbox = true;
            document.getElementById('chatbox').style.display = 'block';
            document.getElementById('user-input').style.display = 'block';
            
            appendMessage('Assistente', "Olá! Estou aqui para debater esta proposta com você.", 'assistant');
            conversationHistory.push({role: "assistant", content: "Olá! Estou aqui para debater esta proposta com você."});
            conversationHistory.push({role: "system", content: `O usuário está avaliando a proposta: "${currentQuestion}". Ajude-o a pensar sobre.`});
        } else {
            showChatbox = false;
            document.getElementById('chatbox').style.display = 'none';
            document.getElementById('user-input').style.display = 'none';
        }
    }

    function startTimer() {
        let timeLeft = 180; // 3 minutos
        const timerDiv = document.getElementById('timer');
        
        if (timerInterval) clearInterval(timerInterval);
        
        timerDiv.innerHTML = `Tempo restante: <span style='color:red'>${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}</span>`;

        timerInterval = setInterval(() => {
            timeLeft--;
            timerDiv.innerHTML = `Tempo restante: <span style='color:red'>${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}</span>`;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById('question-box').style.display = 'block';
                if(isAI) {
                    document.getElementById('user-input').disabled = true;
                }
            }
        }, 1000);
    }

    // --- CHAT ---
    const userInput = document.getElementById('user-input');
    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        appendMessage('Você', text, 'user');
        conversationHistory.push({ role: 'user', content: text });
        userInput.value = '';
        userInput.disabled = true;

        try {
            const res = await fetch(BACKEND_URL + '/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ history: conversationHistory, model: 'gpt', prolificPID: prolificPID, question: currentQuestion })
            });
            const data = await res.json();
            appendMessage('Assistente', data.response, 'assistant');
            conversationHistory.push({ role: 'assistant', content: data.response });
        } catch (err) {
            appendMessage('Erro', 'Falha na conexão.', 'assistant');
        }
        userInput.disabled = false;
        userInput.focus();
    }

    function appendMessage(sender, text, cls) {
        const div = document.createElement('div');
        div.className = `message ${cls}`;
        div.innerHTML = `<strong>${sender}:</strong> ${text}`;
        const cb = document.getElementById('chatbox');
        cb.appendChild(div);
        cb.scrollTop = cb.scrollHeight;
    }

    // --- VOTO ---
    document.getElementById('submit-vote-btn').onclick = async () => {
        const vote = document.querySelector('input[name="ai_vote"]:checked');
        if (!vote) { alert("Selecione uma opção."); return; }

        await fetch(BACKEND_URL + '/vote', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                vote: vote.value,
                question: currentQuestion,
                category: categories[currentCategoryIndex].name,
                prolificPID: prolificPID,
                showChatbox: showChatbox
            })
        });

        document.querySelectorAll('input[name="ai_vote"]').forEach(r => r.checked = false);
        currentCategoryIndex++;
        loadNextProposal();
    };

    // --- FINALIZAR ---
    function finishSurvey() {
        const payload = collectAllData();
        
        fetch(BACKEND_URL + '/survey', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        }).then(() => {
            showFinalPage();
        }).catch(err => {
            console.error("Erro ao salvar survey", err);
            showFinalPage();
        });
    }

    function showFinalPage() {
        document.getElementById('description').style.display = 'none';
        document.getElementById('question-box').style.display = 'none';
        document.getElementById('chatbox').style.display = 'none';
        document.getElementById('timer').style.display = 'none';
        document.getElementById('user-input').style.display = 'none';
        document.querySelector('.survey-container').style.display = 'none'; 

        document.getElementById('final-consultation-page').style.display = 'block';
    }

    function collectAllData() {
        const getVal = (name) => document.querySelector(`input[name="${name}"]:checked`)?.value;
        
        return {
            prolificPID: prolificPID,
            question1: getVal('question1'),
            demografia: {
                genero: getVal('demo_genero'),
                regiao: getVal('demo_regiao'),
                faixa_etaria: getVal('demo_faixa_etaria'),
                cor: getVal('demo_cor'),
                renda: getVal('demo_renda'),
                religiao: getVal('demo_religiao'),
                escolaridade: getVal('demo_escolaridade')
            },
            q_ai: {
                preference: getVal('q_ai_preference'),
                better_worker: getVal('q_ai_better_worker'),
                discomfort: getVal('q_ai_discomfort'),
                control: getVal('q_ai_control'),
                trivial: getVal('q_ai_trivial')
            },
            question2: getVal('question2'),
            question3: getVal('question3'),
            question4: getVal('question4'),
            question6: getVal('question6'),
            question7: getVal('question7'),
            question8: getVal('question8'),
            question9: getVal('question9'),
            question5: {
                q5_jornal_diario: getVal('q5_jornal_diario'),
                q5_jornais_tv: getVal('q5_jornais_tv'),
                q5_jornais_radio: getVal('q5_jornais_radio'),
                q5_redes_sociais: getVal('q5_redes_sociais'),
                q5_conversas: getVal('q5_conversas'),
                q5_ia: getVal('q5_ia')
            }
        };
    }

    // Consent Buttons
    window.acceptConsent = () => {
        document.getElementById('consent-section').style.display = 'none';
        document.querySelector('.survey-container').style.display = 'flex';
        document.getElementById('survey-questions').style.display = 'block';
    };
    window.declineConsent = () => {
        document.getElementById('consent-section').innerHTML = "<h3>Obrigado.</h3>";
    };
</script>

</body>
</html>